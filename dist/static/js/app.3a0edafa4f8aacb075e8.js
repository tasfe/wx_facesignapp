webpackJsonp([1],{12:function(t,a,e){"use strict";function n(t){return location.href=m.fetchUerId,f.a.get(m.fetchUerId)}function o(t){var a=p.a.get("userid");return f.a.get(m.fetchUser,{params:{userid:a}},d()({},T,t.config))}function s(){var t=p.a.get("userid");return f.a.get(m.fetchIsTakePhoto,{params:{userid:t,time:+new Date}},d()({},T))}function i(t){var a=p.a.get("userid");return f.a.post(m.getUserPhoto,d()({},t,{userid:a,time:+new Date}),d()({},T))}function r(t){var a=p.a.get("userid");return f.a.post(m.postUserPhoto,d()({},t,{userid:a,time:+new Date}),d()({},T))}function c(){return f.a.get(m.getWXConfig,{params:d()({url:location.href.split("#")[0]})},d()({},T))}var u=e(23),d=e.n(u),l=e(56),f=e.n(l),_=e(77),h=e(51),p=e.n(h),m={fetchUser:_.a.apiPath+"/mockjsdata/3/get_meesage",fetchIsTakePhoto:_.a.apiPath+"/web/wx/user/detail",getWXConfig:_.a.apiPath+"/web/wx/home/get-wx-js-config",fetchUerId:_.a.apiPath+"/web/wx/home/auth",postUserPhoto:_.a.apiPath+"/web/wx/user/sign-in",getUserPhoto:_.a.apiPath+"/web/wx/home/upload-image"},T={baseURL:"",timeout:4e3};a.a={fetchUser:o,fetchIsTakePhoto:s,getWXConfig:c,postUserPhoto:r,getUserPhoto:i,fetchUerId:n}},126:function(t,a){},127:function(t,a){},128:function(t,a){},13:function(t,a,e){"use strict";a.a={GET_WX_READY:"GET_WX_READY",SET_WX_READY:"SET_WX_READY"}},131:function(t,a,e){e(127);var n=e(32)(e(75),e(134),null,null);t.exports=n.exports},132:function(t,a,e){e(126);var n=e(32)(e(76),e(133),null,null);t.exports=n.exports},133:function(t,a,e){t.exports={render:function(){var t=this,a=t.$createElement;t._self._c;return t._m(0)},staticRenderFns:[function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("div",{staticClass:"info"},[n("img",{staticClass:"title-banner",attrs:{src:e(52)}})])}]}},134:function(t,a,e){t.exports={render:function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("div",{staticClass:"home"},[n("img",{staticClass:"title-banner",attrs:{src:e(52)}}),t._v(" "),n("span",{directives:[{name:"show",rawName:"v-show",value:t.wxReady&&!t.isTakePhoto,expression:"wxReady&&!isTakePhoto"}],staticClass:"btn upload",attrs:{alt:"签到"},on:{click:t.openCamer}}),t._v(" "),t.isTakePhoto?n("div",{staticClass:"info"},[n("div",{staticClass:"info-user_image"},[n("img",{attrs:{src:t.userPhotoInfo.face_image,alt:"用户自拍"}})]),t._v(" "),n("div",{staticClass:"info-user_content"},[n("p",[n("span",{staticClass:"key"},[t._v("姓名 : ")]),n("span",{staticClass:"value"},[t._v(t._s(t.userPhotoInfo.name))])]),t._v(" "),n("p",[n("span",{staticClass:"key"},[t._v("年龄 : ")]),n("span",{staticClass:"value"},[t._v(t._s(t.userPhotoInfo.age))])]),t._v(" "),n("p",[n("span",{staticClass:"key"},[t._v("性别 : ")]),n("span",{staticClass:"value"},[t._v(t._s(t.userPhotoInfo.gender))])]),t._v(" "),n("p",[n("span",{staticClass:"key"},[t._v("情绪 : ")]),n("span",{staticClass:"value"},[t._v(t._s(t.userPhotoInfo.emotion))])]),t._v(" "),n("p",[n("span",{staticClass:"key"},[t._v("人种 : ")]),n("span",{staticClass:"value"},[t._v(t._s(t.userPhotoInfo.ethnicity))])]),t._v(" "),n("p",[n("span",{staticClass:"key"},[t._v("微笑程度 : ")]),n("span",{staticClass:"value"},[t._v(t._s(t.userPhotoInfo.smile))])])])]):t._e(),t._v(" "),!t.wxReady||t.showLoading?n("div",{staticClass:"loading"},[t._m(0),t._v(" "),n("div",{staticClass:"mask"})]):t._e()])},staticRenderFns:[function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"content"},[e("div",{staticClass:"loading-img"})])}]}},135:function(t,a){t.exports={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{attrs:{id:"app"}},[e("transition",{attrs:{name:"fade",mode:"out-in"}},[e("keep-alive",[e("router-view")],1)],1)],1)},staticRenderFns:[]}},14:function(t,a,e){"use strict";a.a={GET_USER:"GET_USER",GET_IS_TAKE_PHOTO:"GET_IS_TAKE_PHOTO",GET_USER_PHOTO_INFO:"GET_USER_PHOTO_INFO",SET_WEIXIN_READY:"SET_WEIXIN_READY",FETCH_USER_INFO:"FETCH_USER_INFO",FETCH_IS_TAKE_PHOTO:"FETCH_IS_TAKE_PHOTO",POST_USER_PHOTO:"POST_USER_PHOTO"}},21:function(t,a,e){"use strict";e.d(a,"b",function(){return u});var n=e(8),o=e.n(n),s=e(11),i=e(20),r=e(85),c=e(81);s.a.use(i.b);var u=o()({},r.a,c.a);a.a=new i.b.Store({modules:{App:c.b,Home:r.b},strict:!0})},52:function(t,a,e){t.exports=e.p+"static/img/title.547248b.png"},53:function(t,a,e){"use strict";var n=e(11),o=e(136),s=e(131),i=e.n(s),r=e(132),c=e.n(r);n.a.use(o.a),a.a=new o.a({routes:[{path:"/",name:"Home",component:i.a},{path:"/info",name:"Info",component:c.a}]})},54:function(t,a,e){e(128);var n=e(32)(e(74),e(135),null,null);t.exports=n.exports},74:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e(8),o=e.n(n),s=e(12),i=e(20),r=e(21),c=e(51),u=e.n(c);a.default={name:"app",created:function(){u.a.get("userid")||s.a.fetchUerId().then(function(){}).catch(function(t){})},mounted:function(){var t=this;s.a.getWXConfig().then(function(a){a.data&&a.data.result&&(wx.config({debug:!1,appId:a.data.data.appId,timestamp:a.data.data.timestamp,nonceStr:a.data.data.nonceStr,signature:a.data.data.signature,jsApiList:["chooseImage","uploadImage","downloadImage"]}),wx.ready(function(){t.checkWX({wxReady:!0})}))})},methods:o()({},e.i(i.a)({checkWX:r.b.SET_WX_READY}))}},75:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e(8),o=e.n(n),s=e(20),i=e(12),r=e(21);e(11);a.default={name:"home",data:function(){return{localIds:null,showLoading:!1,text:null}},activated:function(){},watch:{wxReady:function(){this.fetchUser()}},updated:function(){},props:{name:{type:String}},computed:o()({},e.i(s.c)({wxReady:r.b.GET_WX_READY,isTakePhoto:r.b.GET_IS_TAKE_PHOTO,userPhotoInfo:r.b.GET_USER_PHOTO_INFO})),methods:o()({openCamer:function(){var t=this;wx.chooseImage({count:1,sizeType:["compressed"],sourceType:["camera"],success:function(a){t.localIds=a.localIds,console.log("upload serverId",a.localIds,t.localIds),t.showLoading=!0,t.text="上传中,请勿动手机",t.uploadFile()},error:function(){alert("选择图片失败")}})},uploadFile:function(){var t=this;wx.uploadImage({localId:t.localIds[0],isShowProgressTips:1,success:function(a){var e=a.serverId;console.log("upload serverId",e),t.takePhoto(e)},error:function(){alert("上传图片失败")}})},fetchUser:function(){var t=this;this.showLoading=!0,this.text="正在获取用户信息",this.checkIsTakePhoto().then(function(a){t.showLoading=!1}).catch(function(a){t.showLoading=!1,alert(a.data.msg)})},takePhoto:function(t){var a=this,e=this;i.a.getUserPhoto({media_id:t}).then(function(t){console.log(t,"res"),t.data.data.image&&(e.upload_image=t.data.data.image.original,a.time=12,e.uploadFaceImage())}).catch(function(){a.showLoading=!1,alert("上传图片失败,请重试")})},uploadFaceImage:function(){console.log("uploadFaceImage");var t=this;this.postUserPhoto({face_image:t.upload_image}).then(function(a){t.showLoading=!1}).catch(function(a){1001===a.data.errcode?(alert(a.data.msg),t.showLoading=!1):t.uploadTask()})},uploadTask:function(){var t=this;t.time--,t.time<0?(t.showLoading=!1,alert("上传图片失败,请重试")):setTimeout(function(){t.uploadFaceImage()},5e3)}},e.i(s.a)({checkIsTakePhoto:r.b.FETCH_IS_TAKE_PHOTO,postUserPhoto:r.b.POST_USER_PHOTO}))}},76:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});e(20);a.default={name:"info",data:function(){return{}},props:{name:{type:String}},computed:{},methods:{}}},77:function(t,a,e){"use strict";a.a={apiPath:"http://hkds.mingyuanyun.com/face-signin"}},78:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e(11),o=e(54),s=e.n(o),i=e(53),r=e(21),c=e(55);e.n(c);n.a.config.productionTip=!1,e.i(c.sync)(r.a,i.a),new n.a({el:"#app",store:r.a,router:i.a,template:"<App/>",components:{App:s.a}})},79:function(t,a,e){"use strict";var n=e(4),o=e.n(n),s=e(13);e(12);a.a=o()({},s.a.SET_WX_READY,function(t,a){(0,t.commit)(s.a.SET_WX_READY,a)})},80:function(t,a,e){"use strict";var n=e(4),o=e.n(n),s=e(13);a.a=o()({},s.a.GET_WX_READY,function(t){return t.wxReady})},81:function(t,a,e){"use strict";e.d(a,"a",function(){return u});var n=e(8),o=e.n(n),s=e(82),i=e(80),r=e(79),c=e(13),u=o()({},c.a);a.b={state:{wxReady:!1},mutations:s.a,getters:i.a,actions:r.a}},82:function(t,a,e){"use strict";var n=e(4),o=e.n(n),s=e(13);a.a=o()({},s.a.SET_WX_READY,function(t,a){t.wxReady=a.wxReady})},83:function(t,a,e){"use strict";var n,o=e(4),s=e.n(o),i=e(88),r=e.n(i),c=e(14),u=e(12);a.a=(n={},s()(n,c.a.FETCH_USER_INFO,function(t,a){var e=t.commit;return new r.a(function(t,n){u.a.fetchUser(a).then(function(a){a.data.result?(t(a.data.data),e(c.a.FETCH_USER_INFO,{data:a.data.data})):n({error:!0,data:a.data})}).catch(function(t){n({error:!0,data:t.data})})})}),s()(n,c.a.FETCH_IS_TAKE_PHOTO,function(t,a){var e=t.commit;return new r.a(function(t,n){u.a.fetchIsTakePhoto(a).then(function(a){a.data.result?(t(a.data.data),e(c.a.FETCH_IS_TAKE_PHOTO,{data:a.data.data})):n({error:!0,data:a.data})}).catch(function(t){n({error:!0,data:t.data})})})}),s()(n,c.a.POST_USER_PHOTO,function(t,a){var e=t.commit;return new r.a(function(t,n){u.a.postUserPhoto(a).then(function(a){a.data.result?(t(a.data.data),e(c.a.POST_USER_PHOTO,{data:a.data.data})):n({error:!0,data:a.data})}).catch(function(t){console.log(t),n({error:!0,data:t.data})})})}),n)},84:function(t,a,e){"use strict";var n,o=e(4),s=e.n(o),i=e(14);a.a=(n={},s()(n,i.a.GET_USER,function(t){return t.user}),s()(n,i.a.GET_IS_TAKE_PHOTO,function(t){return t.isTakePhoto}),s()(n,i.a.GET_USER_PHOTO_INFO,function(t){return t.info}),n)},85:function(t,a,e){"use strict";e.d(a,"a",function(){return u});var n=e(8),o=e.n(n),s=e(86),i=e(84),r=e(83),c=e(14),u=o()({},c.a);a.b={state:{user:{userid:null,name:null,mobile:null,gender:null,avatar:null,email:null},isTakePhoto:!1,info:{age:null,ethnicity:null,emotion:null,face_image:null,name:null,gender:null,smile:null,comment:null}},mutations:s.a,getters:i.a,actions:r.a}},86:function(t,a,e){"use strict";var n,o=e(4),s=e.n(o),i=e(23),r=e.n(i),c=e(14);a.a=(n={},s()(n,c.a.FETCH_USER_INFO,function(t,a){}),s()(n,c.a.FETCH_IS_TAKE_PHOTO,function(t,a){a.data&&a.data.face_image?(t.isTakePhoto=!0,r()(t.info,a.data)):t.isTakePhoto=!1}),s()(n,c.a.POST_USER_PHOTO,function(t,a){t.isTakePhoto=!0,r()(t.info,a.data)}),n)}},[78]);
//# sourceMappingURL=app.3a0edafa4f8aacb075e8.js.map